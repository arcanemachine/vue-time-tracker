<!doctype html>
<html>
	<head>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
		<title>Vue - Time Tracker</title>

    <style>

body {
  font-family: Helvetica;
  margin: 2em;
}

.bold {
  font-weight: bold;
}

.fake-link {
  text-decoration: underline;
  cursor: pointer;
}

    </style>

	</head>
	<body>
    <h1 style="text-align: center; margin-bottom: 1em;">Vue - Time Tracker</h1>

    <div id="app">

      <div>
        <button id="timer__start-button" @click="startTimer()" :disabled="startButtonDisabled">start</button>
        <button id="timer__pause-button" @click="pauseTimer()" :disabled="pauseButtonDisabled">pause</button>
        <button id="timer__resume-button" @click="resumeTimer()" :disabled="resumeButtonDisabled">resume</button>
        <button id="timer__stop-button" @click="stopTimer()" :disabled="stopButtonDisabled">stop</button>
        <button id="timer__reset-button" @click="resetTimer()" :disabled="resetButtonDisabled">reset</button>
        <button id="timer__toggle-debug" @click="showDebugInfo = !showDebugInfo">show/hide debug</button></p>
      </div>

      <div id="timer" style="margin-top: 2em;">{{ formattedTimer }}</div>

      <div v-show="showDebugInfo" style="margin-top: 2em;">
        <p>startTime: <span id='start-time'></span></p>
        <p>stopTime: <span id='stop-time'></span></p>
        <p>lastUpdateTime: <span id='last-update-time'></span></p>
        <p>runSeconds: <span id='run-seconds'></span></p>
        <p>pauseSeconds: <span id='pause-seconds'></span></p>
        <p>isRunning: <span id='is-running'></span></p>
        <button id="timer__update-time" @click="updateDisplay()">update timer</button></p>
      </div>

    </div>

  <script>

"use strict";

// html elements
let startButton = document.getElementById('timer__start-button');
let pauseButton = document.getElementById('timer__pause-button');
let resumeButton = document.getElementById('timer__resume-button');
let stopButton = document.getElementById('timer__stop-button');
let resetButton = document.getElementById('timer__reset-button');

let displayTimer = document.getElementById('timer');

var app = new Vue({
  el: '#app',
  data: {
    currentTime: 0,
    elapsedSeconds: 0,

    timer: {
      startTime: 0,
      stopTime: 0,
      lastUpdateTime: 0,
      runSeconds: 0,
      pauseSeconds: 0,
      isRunning: false
    },

    startButtonDisabled: false,
    pauseButtonDisabled: true,
    resumeButtonDisabled: true,
    stopButtonDisabled: true,
    resetButtonDisabled: true,

    showDebugInfo: false,
  },
  computed: {
    formattedTimer: function () {
      return this.getFormattedTime();
    }
  },
  methods: {
    // timer logic
    startTimer: function () {
      if (this.timer.isRunning) {return undefined;}
      this.timer.startTime = performance.now();
      this.timer.lastUpdateTime = this.timer.startTime;
      this.timer.isRunning = true;

      setInterval('app.updateDisplay()', 100);
      this.disableButtons(['start', 'resume', 'reset']);
    },
    pauseTimer: function () {
      if (this.timerIsStopped() || this.timerIsPaused()) {return undefined;}
      this.timer.runSeconds += this.getSecondsSinceLastUpdate();
      this.timer.isRunning = false;
      this.timer.lastUpdateTime = performance.now();

      this.updateDisplay()
      this.disableButtons(['start', 'pause', 'reset']);
    },
    resumeTimer: function () {
      if (this.timer.isRunning) {return false;}
      this.currentTime = performance.now()
      this.elapsedSeconds = this.getSecondsSinceLastUpdate();
      this.timer.lastUpdateTime = this.currentTime;
      this.timer.stopTime = 0;
      this.timer.isRunning = true;

      this.updateDisplay()
      this.disableButtons(['start', 'resume', 'reset']);
    },
    stopTimer: function () {
      if (this.timerIsStopped()) {return undefined;}
      else if (this.timerIsPaused()) {this.timer.pauseSeconds += this.getSecondsSinceLastUpdate();}
      else if (this.timer.isRunning) {this.timer.runSeconds += this.getSecondsSinceLastUpdate();}
      this.timer.stopTime = performance.now();
      this.timer.lastUpdateTime = this.timer.stopTime;
      this.timer.isRunning = false;

      this.updateDisplay()
      this.disableButtons(['start', 'pause', 'stop']);
    },
    resetTimer: function () {
      this.timer.startTime = 0;
      this.timer.stopTime = 0;
      this.timer.lastUpdateTime = 0;
      this.timer.runSeconds = 0;
      this.timer.pauseSeconds = 0;

      this.updateDisplay()
      this.disableButtons(['pause', 'resume', 'stop', 'reset']);
    },
    getSecondsSinceLastUpdate: function () {
      return Math.floor((performance.now() - this.timer.lastUpdateTime) / 1000);
    },
    timerIsPaused: function () {
      if (this.timer.lastUpdateTime !== this.timer.stopTime && !this.timer.isRunning) {return true;}
      else {return false;}
    },
    timerIsStopped: function () {
      if (this.timer.lastUpdateTime === this.timer.stopTime && !this.timer.isRunning) {return true;}
      else {return false;}
    },
    getUUID: function () {
      return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
      );
    },
    // user interface
    zeroPadder: function (yourNumber, minLength=2) {
      // get the minimum length of the result
      let sliceLength = minLength;
      let numLength = String(yourNumber).length;
      if (numLength > minLength) {sliceLength = numLength;}
      
      // create a string of zeroes
      let zeroString = '';
      for (let i = 0; i < sliceLength; i++) {zeroString += '0';}
      
      // return a string that is at least the length of minLength
      return (zeroString + String(yourNumber)).slice(numLength);
    },
    getFormattedTime: function () {
      // get elapsed time
      if (this.timer.isRunning) {this.elapsedSeconds = this.getSecondsSinceLastUpdate() + this.timer.runSeconds;}
      else {this.elapsedSeconds = this.timer.runSeconds;}

      let seconds = this.elapsedSeconds % 60;
      let minutes = Math.floor((this.elapsedSeconds / 60) % 60);
      let hours = Math.floor(this.elapsedSeconds / 3600);

      return this.zeroPadder(hours) +':'+ this.zeroPadder(minutes) +':'+ this.zeroPadder(seconds);
    },
    updateDisplay: function () {
      displayTimer.innerHTML = this.getFormattedTime();

      document.getElementById('run-seconds').innerHTML = this.timer.runSeconds;
      document.getElementById('pause-seconds').innerHTML = this.timer.pauseSeconds;
      document.getElementById('start-time').innerHTML = this.timer.startTime;
      document.getElementById('stop-time').innerHTML = this.timer.stopTime;
      document.getElementById('last-update-time').innerHTML = this.timer.lastUpdateTime;
      document.getElementById('is-running').innerHTML = this.timer.isRunning;
    },
    disableButtons: function (buttonsToDisable) {
      if (buttonsToDisable.includes('start')) {
        this.startButtonDisabled = true;
      } else {
        this.startButtonDisabled = false;
      }
      if (buttonsToDisable.includes('pause')) {
        this.pauseButtonDisabled = true;
      } else {
        this.pauseButtonDisabled = false;
      }
      if (buttonsToDisable.includes('resume')) {
        this.resumeButtonDisabled = true;
      } else {
        this.resumeButtonDisabled = false;
      }
      if (buttonsToDisable.includes('stop')) {
        this.stopButtonDisabled = true;
      } else {
        this.stopButtonDisabled = false;
      }
      if (buttonsToDisable.includes('reset')) {
        this.resetButtonDisabled = true;
      } else {
        this.resetButtonDisabled = false;
      }
    }
  }
});


// view logic
// displayTimer.innerHTML = app.getFormattedTime();
// app.disableButtons(['pause', 'resume', 'stop', 'reset']);

  </script>

	</body>
</html>
